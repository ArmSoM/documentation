---
sidebar_label: "3.I2C Usage"
slug: /interface-usage/i2c
sidebar_position: 3
---

# 3. I2C Usage

I2C (Inter-Integrated Circuit) is a widely used serial communication protocol primarily used for data communication between a master device (e.g., microcontroller, processor) and peripheral devices (such as sensors, displays, memories, etc.). It is simple and efficient, making it well-suited for short-distance, low-speed data transmission.

## 3.1 I2C Communication Working Principle

I2C uses two wires for communication:

- **SCL (Serial Clock Line)**: The clock signal generated by the master device to synchronize data transmission.
- **SDA (Serial Data Line)**: Used to transfer data between devices.

I2C is a multi-master, multi-slave protocol, meaning that multiple master and slave devices can be connected to the bus, but only one master device can control communication at any given time.

## 3.2 I2C Usage Example

### 3.2.1 I2C Pins

The ArmSoM series boards, such as the CM5-IO, have I2C peripherals on the 40-pin header. Here's an example using CM5-IO, referring to the [CM5-IO 40PIN Pinout](/interface-usage/40pin#16-armsom-cm5-io):

| I2C       | Pin        | Function      |  
| --------- | ---------- | ------------- |  
| I2C3_SDA_M0 | Pin 3     | I2C3 Data Line  |  
| I2C3_SCL_M0 | Pin 5     | I2C3 Clock Line |  
| I2C7_SDA_M1 | Pin 19    | I2C7 Data Line  |  
| I2C7_SCL_M1 | Pin 23    | I2C7 Clock Line |  
| I2C4_SDA_M3 | Pin 27    | I2C4 Data Line  |  
| I2C4_SCL_M3 | Pin 29    | I2C4 Clock Line |  
| I2C6_SDA_M2 | Pin 89    | I2C6 Data Line  |  
| I2C6_SCL_M2 | Pin 88    | I2C6 Clock Line |  

### 3.2.2 Enabling I2C Communication Interface

By default, the I2C interface is disabled and needs to be enabled for use.

In the Armbian operating system, the `/boot/armbianEnv.txt` file is used to configure parameters and device tree overlays during the system boot process. You can edit this file to enable or disable I2C device tree overlays, ensuring the I2C bus is correctly loaded at boot.

If you want to check or enable I2C-related device tree overlays, follow these steps:

- **Check Device Tree Overlay Configuration**

Open the file: Open the `/boot/armbianEnv.txt` file using a text editor like `nano` or `vim`, for example:

```bash
sudo nano /boot/armbianEnv.txt
```

Here, weâ€™ll enable `i2c3-m0` as an example, by adding `rk3576-i2c3-m0` like this:

```
overlays=rk3576-i2c3-m0
```

The `overlays` line specifies the device tree overlays (e.g., `i2c0` and `i2c1` are common I2C bus overlays). If you don't see these, you can manually add them.

After editing, save the file and exit the editor. Then reboot the system to apply the changes:

```bash
// First, execute sync
root@armsom-cm5-io:/home/armsom# sync
root@armsom-cm5-io:/home/armsom# sudo reboot
```

![rockchip-i2c](/img/general-tutorial/interface-usage/i2c-rtc.png)

- **Verify I2C is Enabled**

After rebooting, you can check if I2C is functioning properly by using the following commands:

Check for I2C devices: Use the `i2cdetect` tool to check if the I2C bus is available:

```
root@armsom-cm5-io:/home/armsom# sudo apt-get install i2c-tools  # If not installed, install i2c-tools
root@armsom-cm5-io:/home/armsom# sudo i2cdetect -y 3
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
60: -- -- -- -- -- -- -- -- 68 -- -- -- -- -- -- -- 
70: -- -- -- -- -- -- -- -- 
```

`-y 3` checks the first I2C bus. If a list of device addresses is returned, it means I2C has been successfully enabled and is working.

:::tip
- Ensure that the hardware itself supports and has the appropriate I2C bus enabled. For custom hardware, make sure the connections are correct and the hardware supports the I2C interface.
- Different Armbian versions and hardware platforms may have different names for the device tree overlays, so adjust the overlay names according to your specific platform.
:::
